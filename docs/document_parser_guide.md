# FusionAI æ–‡æ¡£è§£æå‘˜åŠŸèƒ½æŒ‡å—

## æ¦‚è¿°

FusionAI æ–‡æ¡£è§£æå‘˜æ˜¯ä¸€ä¸ªæ™ºèƒ½çš„æ–‡æ¡£å¤„ç†æ™ºèƒ½ä½“ï¼Œèƒ½å¤Ÿå¤„ç† PDF å’Œ Word æ–‡æ¡£ï¼Œæä¾›æ–‡æ¡£å†…å®¹è§£æã€åˆ†æå’Œé—®ç­”åŠŸèƒ½ã€‚è¯¥æ™ºèƒ½ä½“å®Œå…¨é›†æˆåˆ° FusionAI çš„å¤šæ™ºèƒ½ä½“åä½œä½“ç³»ä¸­ï¼Œå¯ç”± coordinatorã€planner å’Œ supervisor è¿›è¡Œç®¡ç†è°ƒåº¦ã€‚

## åŠŸèƒ½ç‰¹æ€§

### ğŸ” æ–‡æ¡£å¤„ç†èƒ½åŠ›
- **æ”¯æŒæ ¼å¼**: PDF (.pdf)ã€Word (.docxã€.doc)
- **å†…å®¹æå–**: æ™ºèƒ½æ–‡æœ¬æå–å’Œç»“æ„åŒ–å¤„ç†
- **æ–‡ä»¶å­˜å‚¨**: åŸºäº MinIO çš„å¯é æ–‡ä»¶å­˜å‚¨
- **å…ƒæ•°æ®ç®¡ç†**: å®Œæ•´çš„æ–‡æ¡£ä¿¡æ¯è¿½è¸ª

### ğŸ§  æ™ºèƒ½åˆ†æèƒ½åŠ›
- **å†…å®¹åˆ†æ**: æ–‡æ¡£ç»“æ„ã€ä¸»é¢˜ã€å…³é”®è¯è¯†åˆ«
- **ç»Ÿè®¡ä¿¡æ¯**: å­—æ•°ã€è¡Œæ•°ã€æ®µè½æ•°ç­‰ç»Ÿè®¡
- **å†…å®¹æœç´¢**: æ–‡æ¡£å†…å…³é”®è¯æœç´¢å’Œä¸Šä¸‹æ–‡æå–
- **é—®ç­”åŠŸèƒ½**: åŸºäºæ–‡æ¡£å†…å®¹çš„æ™ºèƒ½é—®ç­”

### ğŸ¤ æ™ºèƒ½ä½“åä½œ
- **åè°ƒç®¡ç†**: ç”± coordinator ç»Ÿä¸€è°ƒåº¦
- **è®¡åˆ’é›†æˆ**: å¯çº³å…¥ planner çš„ä»»åŠ¡è§„åˆ’
- **ç›‘ç£æ§åˆ¶**: å— supervisor ç›‘ç£å’Œè·¯ç”±
- **ç»“æœåé¦ˆ**: å‘å…¶ä»–æ™ºèƒ½ä½“æä¾›åˆ†æç»“æœ

## ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Coordinator   â”‚â”€â”€â”€â–¶â”‚    Planner      â”‚â”€â”€â”€â–¶â”‚   Supervisor    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                       â”‚
                                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Researcher    â”‚     Coder       â”‚   DB Analyst    â”‚Document Parser  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                       â”‚
                                                       â–¼
                                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                       â”‚         MinIO              â”‚
                                       â”‚   æ–‡æ¡£å­˜å‚¨å’Œç®¡ç†            â”‚
                                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ç¯å¢ƒè®¾ç½®

### 1. å®‰è£…ä¾èµ–
```bash
# å·²åŒ…å«åœ¨é¡¹ç›®ä¾èµ–ä¸­
uv add minio PyPDF2 python-docx python-multipart aiofiles
```

### 2. å¯åŠ¨ MinIO æœåŠ¡
```bash
# ä½¿ç”¨æä¾›çš„è„šæœ¬
./scripts/setup_minio.sh

# æˆ–æ‰‹åŠ¨å¯åŠ¨ Docker å®¹å™¨
docker run -d \
  --name fusionai-minio \
  -p 9000:9000 \
  -p 9001:9001 \
  -v ./data/minio:/data \
  -e "MINIO_ROOT_USER=minioadmin" \
  -e "MINIO_ROOT_PASSWORD=minioadmin" \
  minio/minio server /data --console-address ":9001"
```

### 3. ç¯å¢ƒå˜é‡é…ç½®
åœ¨ `.env` æ–‡ä»¶ä¸­æ·»åŠ ï¼š
```env
# MinIO é…ç½®
MINIO_ENDPOINT=localhost:9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin
MINIO_BUCKET_NAME=fusionai-documents
MINIO_SECURE=false
```

## API æ¥å£

### æ–‡æ¡£ä¸Šä¼ 
```http
POST /api/documents/upload
Content-Type: multipart/form-data

å‚æ•°:
- file: æ–‡æ¡£æ–‡ä»¶ (PDF/Word)

å“åº”:
{
  "success": true,
  "message": "æ–‡æ¡£ä¸Šä¼ æˆåŠŸ",
  "file_id": "uuid-string",
  "download_url": "/api/documents/{file_id}",
  "document_info": {
    "filename": "example.pdf",
    "file_type": ".pdf",
    "file_size": 1024,
    "content_length": 2048,
    "uploaded_at": "2024-01-01T00:00:00"
  }
}
```

### è·å–æ–‡æ¡£ä¿¡æ¯
```http
GET /api/documents/{file_id}?include_content=true

å“åº”:
{
  "success": true,
  "data": {
    "file_id": "uuid-string",
    "filename": "example.pdf",
    "file_type": ".pdf",
    "content": "æ–‡æ¡£å®Œæ•´å†…å®¹...",
    "content_length": 2048,
    "file_size": 1024,
    "uploaded_at": "2024-01-01T00:00:00",
    "parsed_at": "2024-01-01T00:00:01"
  }
}
```

### æ–‡æ¡£åˆ†æ
```http
POST /api/documents/{file_id}/analyze
Content-Type: application/json

{
  "analysis_request": "è¯·åˆ†ææ–‡æ¡£çš„ä¸»è¦å†…å®¹å’Œç»“æ„"
}

å“åº”:
{
  "success": true,
  "data": {
    "file_id": "uuid-string",
    "filename": "example.pdf",
    "content_length": 2048,
    "word_count": 300,
    "line_count": 50,
    "paragraph_count": 10,
    "content_preview": "æ–‡æ¡£å†…å®¹é¢„è§ˆ...",
    "analyzed_at": "2024-01-01T00:00:02"
  }
}
```

### ä¸‹è½½åŸå§‹æ–‡æ¡£
```http
GET /api/documents/{file_id}/download

å“åº”: æ–‡ä»¶æµä¸‹è½½
```

### åˆ é™¤æ–‡æ¡£
```http
DELETE /api/documents/{file_id}

å“åº”:
{
  "success": true,
  "message": "æ–‡æ¡£åˆ é™¤æˆåŠŸ",
  "file_id": "uuid-string"
}
```

## æ™ºèƒ½ä½“ä½¿ç”¨

### 1. é€šè¿‡èŠå¤©æ¥å£ä½¿ç”¨

å‘é€åŒ…å«æ–‡æ¡£ç›¸å…³è¯·æ±‚çš„æ¶ˆæ¯åˆ° `/api/chat/stream`:

```json
{
  "messages": [
    {
      "role": "user",
      "content": "è¯·åˆ†ææ–‡æ¡£IDä¸º {file_id} çš„å†…å®¹ï¼Œæå–ä¸»è¦è§‚ç‚¹"
    }
  ]
}
```

### 2. æ™ºèƒ½ä½“å·¥ä½œæµ

1. **Coordinator** æ¥æ”¶ç”¨æˆ·è¯·æ±‚ï¼Œè¯†åˆ«æ–‡æ¡£å¤„ç†éœ€æ±‚
2. **Planner** åˆ¶å®šåŒ…å«æ–‡æ¡£åˆ†æçš„æ‰§è¡Œè®¡åˆ’
3. **Supervisor** å°†ä»»åŠ¡è·¯ç”±ç»™ Document Parser
4. **Document Parser** æ‰§è¡Œæ–‡æ¡£è§£æå’Œåˆ†æ
5. **Reporter** æ•´ç†æœ€ç»ˆæŠ¥å‘Š

### 3. å·¥å…·ä½¿ç”¨

æ–‡æ¡£è§£æå‘˜ä½¿ç”¨ä»¥ä¸‹å·¥å…·ï¼š

- `get_document_info`: è·å–æ–‡æ¡£å®Œæ•´ä¿¡æ¯
- `analyze_document_content`: åˆ†ææ–‡æ¡£å†…å®¹å¹¶æä¾›ç»Ÿè®¡

## ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬æ–‡æ¡£åˆ†æ
```python
# é€šè¿‡APIä¸Šä¼ æ–‡æ¡£
response = requests.post(
    "http://localhost:8000/api/documents/upload",
    files={"file": open("document.pdf", "rb")}
)
file_id = response.json()["file_id"]

# é€šè¿‡èŠå¤©æ¥å£åˆ†æ
chat_request = {
    "messages": [
        {
            "role": "user", 
            "content": f"è¯·åˆ†ææ–‡æ¡£ {file_id}ï¼Œæ€»ç»“ä¸»è¦å†…å®¹"
        }
    ]
}
```

### é«˜çº§åˆ†æè¯·æ±‚
```python
chat_request = {
    "messages": [
        {
            "role": "user",
            "content": f"è¯·å¯¹æ–‡æ¡£ {file_id} è¿›è¡Œæ·±åº¦åˆ†æï¼š1) æå–å…³é”®ä¿¡æ¯ 2) è¯†åˆ«ä¸»è¦è§‚ç‚¹ 3) åˆ†ææ–‡æ¡£ç»“æ„ 4) æä¾›æ‰§è¡Œå»ºè®®"
        }
    ]
}
```

## æœ€ä½³å®è·µ

### 1. æ–‡æ¡£ç®¡ç†
- ä½¿ç”¨æœ‰æ„ä¹‰çš„æ–‡ä»¶å
- å®šæœŸæ¸…ç†ä¸éœ€è¦çš„æ–‡æ¡£
- å¤‡ä»½é‡è¦æ–‡æ¡£çš„ file_id

### 2. åˆ†æä¼˜åŒ–
- æä¾›å…·ä½“çš„åˆ†æè¦æ±‚
- å¯¹å¤§æ–‡æ¡£åˆ†æ®µå¤„ç†
- ç»“åˆå…¶ä»–æ™ºèƒ½ä½“èƒ½åŠ›

### 3. é”™è¯¯å¤„ç†
- æ£€æŸ¥æ–‡æ¡£æ ¼å¼æ”¯æŒ
- å¤„ç†ç½‘ç»œè¿æ¥é—®é¢˜
- ç›‘æ§å­˜å‚¨ç©ºé—´ä½¿ç”¨

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **MinIO è¿æ¥å¤±è´¥**
   - æ£€æŸ¥ Docker æ˜¯å¦è¿è¡Œ
   - éªŒè¯ç«¯å£æ˜¯å¦è¢«å ç”¨
   - ç¡®è®¤ç¯å¢ƒå˜é‡é…ç½®

2. **æ–‡æ¡£è§£æå¤±è´¥**
   - éªŒè¯æ–‡ä»¶æ ¼å¼æ”¯æŒ
   - æ£€æŸ¥æ–‡ä»¶æ˜¯å¦æŸå
   - ç¡®è®¤æ–‡ä»¶å¤§å°é™åˆ¶

3. **æ™ºèƒ½ä½“æ— å“åº”**
   - æ£€æŸ¥ LLM é…ç½®
   - éªŒè¯ API å¯†é’¥
   - æŸ¥çœ‹æ—¥å¿—é”™è¯¯ä¿¡æ¯

### æ—¥å¿—æŸ¥çœ‹
```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
uv run python -m src.api.app

# æŸ¥çœ‹ MinIO æ—¥å¿—
docker logs fusionai-minio
```

## å¼€å‘æ‰©å±•

### æ·»åŠ æ–°æ–‡æ¡£æ ¼å¼
1. åœ¨ `DocumentParser` ç±»ä¸­æ·»åŠ è§£ææ–¹æ³•
2. æ›´æ–° `parse_document` æ–¹æ³•
3. æ·»åŠ ç›¸åº”çš„å†…å®¹ç±»å‹æ˜ å°„

### é›†æˆæ–°åˆ†æåŠŸèƒ½
1. æ‰©å±•åˆ†æå·¥å…·å‡½æ•°
2. æ›´æ–°æ™ºèƒ½ä½“æç¤ºè¯
3. æ·»åŠ æ–°çš„ API ç«¯ç‚¹

---

**æ³¨æ„**: æ–‡æ¡£è§£æå‘˜ä½œä¸º FusionAI æ™ºèƒ½ä½“ä½“ç³»çš„ä¸€éƒ¨åˆ†ï¼Œå®Œå…¨å— coordinatorã€planner å’Œ supervisor çš„ç®¡ç†è°ƒåº¦ï¼Œç¡®ä¿ä¸å…¶ä»–æ™ºèƒ½ä½“çš„åè°ƒå·¥ä½œã€‚ 