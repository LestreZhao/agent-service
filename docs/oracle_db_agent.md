# Oracle数据库智能体使用指南

## 概述

Oracle数据库智能体是一个专门用于Oracle数据库查询和分析的智能助手。它可以帮助您：

- 了解数据库表结构和字段信息
- 执行安全的SQL查询操作
- 分析表之间的关系
- 提供数据洞察和业务分析

## 功能特性

### 1. 表结构分析
- **获取所有表列表**: 查看数据库中的所有可用表
- **字段详细信息**: 获取表的字段名、数据类型、长度、是否可空等信息
- **表关系分析**: 了解表之间的外键关系

### 2. SQL查询执行
- **安全查询**: 只支持SELECT查询，确保数据安全
- **结果限制**: 自动限制返回结果数量，避免过大数据集
- **错误处理**: 提供友好的错误信息和建议

### 3. 智能分析
- **自动分析**: 基于表结构智能构建查询
- **业务洞察**: 从查询结果中提取有价值的信息
- **建议优化**: 提供查询优化和进一步分析建议

## 环境配置

### 1. 安装依赖

确保您的项目中已安装必要的依赖：

```bash
pip install cx_Oracle>=8.3.0
```

### 2. 设置环境变量

创建 `.env` 文件或设置以下环境变量：

```bash
# Oracle数据库连接配置
ORACLE_HOST=your_oracle_host
ORACLE_PORT=1521
ORACLE_SERVICE_NAME=your_service_name
ORACLE_USERNAME=your_username
ORACLE_PASSWORD=your_password
```

### 3. Oracle客户端配置

确保您的系统已安装Oracle客户端：

- **Oracle Instant Client**: 下载并安装适合您系统的版本
- **环境变量设置**: 确保Oracle客户端路径在系统PATH中

## 使用方法

### 基本查询流程

1. **了解数据库结构**
   ```python
   # 获取所有表列表
   get_table_info()
   
   # 获取特定表的详细信息
   get_table_info("EMPLOYEES")
   ```

2. **分析表关系**
   ```python
   # 获取表的外键关系
   get_table_relationships("ORDERS")
   ```

3. **执行查询**
   ```python
   # 执行SQL查询
   execute_oracle_query("SELECT * FROM EMPLOYEES WHERE DEPARTMENT_ID = 10")
   ```

### 示例对话

**用户**: "我想查看员工表的结构"

**智能体响应**:
1. 首先获取数据库中所有表的列表
2. 识别员工相关的表（如EMPLOYEES）
3. 获取EMPLOYEES表的详细字段信息
4. 分析表的外键关系
5. 提供表结构的详细说明

**用户**: "查询销售部门的所有员工"

**智能体响应**:
1. 分析EMPLOYEES和DEPARTMENTS表的关系
2. 构建连接查询
3. 执行查询并返回结果
4. 提供数据分析和洞察

## 安全特性

### 查询限制
- **只读操作**: 仅支持SELECT查询
- **关键字过滤**: 自动阻止危险的SQL关键字
- **结果限制**: 默认限制返回100行数据

### 错误处理
- **连接验证**: 自动验证数据库连接参数
- **异常捕获**: 友好的错误信息提示
- **日志记录**: 详细的操作日志（不包含敏感信息）

## 最佳实践

### 1. 查询优化
- 使用适当的WHERE条件限制结果集
- 避免SELECT *，指定需要的字段
- 合理使用索引字段进行过滤

### 2. 数据安全
- 定期更新数据库连接密码
- 使用只读数据库用户
- 避免在查询中包含敏感信息

### 3. 性能考虑
- 对大表查询时使用ROWNUM或分页
- 避免复杂的子查询和连接
- 定期分析查询执行计划

## 故障排除

### 常见问题

1. **连接失败**
   - 检查网络连接
   - 验证数据库服务状态
   - 确认连接参数正确

2. **权限错误**
   - 检查用户权限
   - 确认对目标表有SELECT权限
   - 联系数据库管理员

3. **查询超时**
   - 优化查询条件
   - 减少结果集大小
   - 检查表索引

### 日志查看

查看应用程序日志获取详细的错误信息：

```bash
tail -f logs/application.log | grep oracle
```

## 支持的Oracle版本

- Oracle Database 11g及以上版本
- Oracle Express Edition (XE)
- Oracle Cloud Database

## 扩展功能

未来可能的扩展功能：

- 支持其他数据库类型（MySQL、PostgreSQL等）
- 查询性能分析
- 数据可视化
- 自动化报表生成

## 技术支持

如有问题或建议，请：

1. 查看项目文档
2. 提交Issue到GitHub仓库
3. 联系开发团队 